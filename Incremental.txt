#!/bin/bash

if [ ! -d /var/tmp/backups ]; then   #si el directorio de los backups no existe, se crea
    mkdir /var/tmp/backups
fi

if [ -z "$(ls -A /var/tmp/backups)" ]; then
    cd /var/tmp/backups   #si el directorio está vacio se debe hacer la primera copia completa
    sudo mkdir completa
    sudo rsync -av /home/urko/Labo1/Copias /var/tmp/backups/completa/
else
     ultimaCarpeta=$(ls -td /var/tmp/backups/*/ |head -1) #comprobar cual es la ultima CARPETA creada en el directorio de los backups (para hacer la incremental respecto a ella)
   	 sudo rsync -av --compare-dest=/var/tmp/backups/completa/ --compare-dest="$ultimaCarpeta" /home/urko/Labo1/Copias /var/tmp/backups/`date +%d-%m-%Y-%H`/
fi

sudo mysqldump -u root -p MYDATABASE > /var/tmp/`date+ %d-%m-%Y`/copiaDB.sql  #copia bd

#urko@urkovb:~$ sudo crontab -e

# Edit this file to introduce tasks to be run by cron.
#
#  [ … ]
# 
#min h dom mon daow
# 0 12 * * * ~/Labo1/backup.sh
##
